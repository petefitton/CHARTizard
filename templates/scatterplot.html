<script>

let typeColors = {
  "bug": "#336600",
  "dark": "#1a001a",
  "dragon": "#4775d1",
  "elecric": "#ffcc00",
  "fairy": "#ff66ff",
  "fighting": "#cc5200",
  "fire": "#cc3300",
  "flying": "#6699cc",
  "ghost": "#660066",
  "grass": "#00cc00",
  "ground": "#604020",
  "ice": "#ccffff",
  "normal": "#b3b3b3",
  "poison": "#cc00ff",
  "psychic": "#ffff4d",
  "rock": "#404040",
  "steel": "#9494b8",
  "water": "#3366cc",
  "": "type1"
}

// set dimensions and margins of scatterplot
var margin = {top: 20, right: 20, bottom: 30, left: 50},
  width = 960 - margin.left - margin.right,
  height = 500 - margin.top - margin.bottom;

// set the ranges of x and y axes
var x = d3.scaleLinear().range([0, width]);
var y = d3.scaleLinear().range([height, 0]);

// svg create and setup + group element create/append that sets area to start in the corner with margins applied
var svg = d3.select("body").append("svg")
  .attr("width", width + margin.left + margin.right)
  .attr("height", height + margin.top + margin.bottom)
.append("g")
  .attr("transform",
        "translate(" + margin.left + "," + margin.top + ")");

// Get the data and process data within a large function
d3.csv("{{url_for('static', filename='data/pokemon.csv')}}").then(function(data) {

  // format data
  data.forEach(function(d) {
    d.capture_rate = +d.capture_rate;
    d.base_total = +d.base_total;
  });

  // Setup domain of data
  x.domain([0, d3.max(data, function(d) { return d.capture_rate; }) + 5]);
  y.domain([d3.min(data, function(d) { return d.base_total; }) - 10, d3.max(data, function(d) { return d.base_total; }) + 20]);
  
  // create defs, linear gradient, and stop elements with appropriate settings
  var defs = svg.append("defs")
  for (type1 in typeColors) {
    for (type2 in typeColors) {
      var linGrad = defs.append("linearGradient")
        .attr("id", type1 + type2)
        .attr("x1", 0)
        .attr("x2", 1)
        .attr("y1", 0)
        .attr("y2", 1)

      linGrad.append("stop")
        .attr("offset", "0%")
        .attr("stop-color", typeColors[type1])
      
      linGrad.append("stop")
        .attr("offset", "100%")
        .attr("stop-color", typeColors[type2])
    }
  }
      
  // Add all dots for the scatterplot
  svg.selectAll("dot")
    .data(data)
  .enter().append("circle")
    .attr("r", 5)
    .attr("cx", function(d) { return x(d.capture_rate); })
    .attr("cy", function(d) { return y(d.base_total); })
    .attr("fill", function(d) {
      return "url(#" + d.type1 + d.type2 + ")"
    })

  // Add x Axis
  svg.append("g")
    .attr("transform", "translate(0," + height + ")")
    .call(d3.axisBottom(x));

  // Add y Axis
  svg.append("g")
    .call(d3.axisLeft(y));

});
</script>